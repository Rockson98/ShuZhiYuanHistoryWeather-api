# å’Œé£å¤©æ°” â†’ Open-Meteo è¿ç§»æ€»ç»“

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### æ ¸å¿ƒä»£ç æ–‡ä»¶

#### 1. `main.py` âœ…
- âœ… ç§»é™¤äº†æ‰€æœ‰å’Œé£å¤©æ°”APIç›¸å…³ä»£ç 
- âœ… ç§»é™¤äº† `QWEATHER_API_KEY`ã€`QWEATHER_API_HOST`ã€`WEATHER_DEFAULT_LOCATION` é…ç½®
- âœ… ç§»é™¤äº† `_fetch_history_from_qweather()` å‡½æ•°
- âœ… ç§»é™¤äº† `_ensure_location()` å‡½æ•°
- âœ… æ–°å¢ `_ensure_latitude_longitude()` å‡½æ•°
- âœ… ç®€åŒ– `weather_history()` ç«¯ç‚¹ï¼Œåªä½¿ç”¨Open-Meteo
- âœ… æ›´æ–° `health()` ç«¯ç‚¹å“åº”
- âœ… æ›´æ–°APIæè¿°å’Œç‰ˆæœ¬å·

#### 2. `config.py` âœ…
- âœ… ç§»é™¤äº† `location_id` å­—æ®µï¼ˆå’Œé£å¤©æ°”ä¸“ç”¨ï¼‰
- âœ… ç§»é™¤äº† `location_name` å­—æ®µï¼ˆå’Œé£å¤©æ°”ä¸“ç”¨ï¼‰
- âœ… ä¿ç•™äº† `latitude` å’Œ `longitude` å­—æ®µï¼ˆOpen-Meteoå¿…éœ€ï¼‰

#### 3. `render.yaml` âœ…
- âœ… ç§»é™¤äº† `QWEATHER_API_KEY` ç¯å¢ƒå˜é‡
- âœ… ç§»é™¤äº† `QWEATHER_API_HOST` ç¯å¢ƒå˜é‡
- âœ… ç§»é™¤äº† `WEATHER_DEFAULT_LOCATION` ç¯å¢ƒå˜é‡
- âœ… ä¿ç•™äº† `WEATHER_PROJECTS_JSON` å’Œ `WEATHER_PROJECTS_FILE`ï¼ˆå¯é€‰ï¼‰

#### 4. `README_éƒ¨ç½²è¯´æ˜.md` âœ…
- âœ… æ›´æ–°äº†å‰ç½®æ¡ä»¶ï¼ˆç§»é™¤å’Œé£å¤©æ°”API Keyè¦æ±‚ï¼‰
- âœ… æ›´æ–°äº†ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜
- âœ… æ›´æ–°äº†ä½¿ç”¨ç¤ºä¾‹
- âœ… æ›´æ–°äº†å¥åº·æ£€æŸ¥å“åº”ç¤ºä¾‹
- âœ… æ›´æ–°äº†å¸¸è§é—®é¢˜è§£ç­”

---

## ğŸ“ APIå˜åŒ–

### ç«¯ç‚¹å‚æ•°å˜åŒ–

**ä¹‹å‰ï¼ˆå’Œé£å¤©æ°”ï¼‰**ï¼š
```
GET /weather/history?location=101281101&date=2024-11-28
GET /weather/history?project_id=1&date=2024-11-28
```

**ç°åœ¨ï¼ˆOpen-Meteoï¼‰**ï¼š
```
GET /weather/history?project_id=1&date=2024-11-28
GET /weather/history?latitude=21.755591&longitude=112.565857&date=2024-11-28
```

**å˜åŒ–**ï¼š
- âŒ ç§»é™¤äº† `location` å‚æ•°
- âœ… ä¿ç•™äº† `project_id` å‚æ•°ï¼ˆè‡ªåŠ¨è·å–ç»çº¬åº¦ï¼‰
- âœ… ä¿ç•™äº† `latitude` å’Œ `longitude` å‚æ•°

### å“åº”æ ¼å¼

å“åº”æ ¼å¼**ä¿æŒä¸å˜**ï¼Œç¡®ä¿å‘åå…¼å®¹ï¼š

```json
{
  "location": "å°å±±æµ·å®´æ¸”å…‰äº’è¡¥é¡¹ç›®",
  "date": "2024-11-28",
  "count": 24,
  "items": [
    {
      "timestamp": "2024-11-28T00:00:00+08:00",
      "temperature": 18.4,
      "humidity": 0.65,
      "wind_speed": 3.1,
      "cloud": 40.0,
      "real_time_irradiance": 0.0,
      "daily_avg_irradiance": 320.5,
      "horizontal_irradiance": 0.0,
      "tilted_irradiance": 0.0,
      "sunshine": 0.6
    }
  ],
  "daily_avg_irradiance": 320.5
}
```

---

## ğŸ¯ ä¼˜åŠ¿

### ä½¿ç”¨Open-Meteoçš„ä¼˜åŠ¿

1. âœ… **å®Œå…¨å…è´¹**ï¼šæ— éœ€API Keyï¼Œæ— éœ€æ³¨å†Œ
2. âœ… **æ•°æ®è´¨é‡æ›´é«˜**ï¼šç›´æ¥æä¾›çŸ­æ³¢è¾å°„æ•°æ®ï¼ˆæ¯”ä¼°ç®—æ›´å‡†ç¡®ï¼‰
3. âœ… **ä»£ç æ›´ç®€æ´**ï¼šç§»é™¤äº†åŒæ•°æ®æºé™çº§é€»è¾‘
4. âœ… **éƒ¨ç½²æ›´ç®€å•**ï¼šæ— éœ€é…ç½®API Key
5. âœ… **å†å²æ•°æ®èŒƒå›´æ›´å¹¿**ï¼šæ”¯æŒè¿‡å»80å¹´çš„å†å²æ•°æ®

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **æäº¤ä»£ç åˆ°GitHub**
   ```bash
   git add .
   git commit -m "è¿ç§»åˆ°Open-Meteoï¼Œç§»é™¤å’Œé£å¤©æ°”ä¾èµ–"
   git push
   ```

2. **Renderä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²**ï¼ˆå¦‚æœå¯ç”¨äº†autoDeployï¼‰

3. **æµ‹è¯•API**
   ```bash
   # å¥åº·æ£€æŸ¥
   curl https://shuzhiyuanhistoryweather-api.onrender.com/health
   
   # æŸ¥è¯¢å†å²å¤©æ°”
   curl "https://shuzhiyuanhistoryweather-api.onrender.com/weather/history?project_id=1&date=2024-11-28"
   ```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¿…é¡»æä¾›ç»çº¬åº¦**ï¼šOpen-Meteoéœ€è¦ç»çº¬åº¦åæ ‡
   - æ¨èä½¿ç”¨ `project_id` è‡ªåŠ¨è·å–
   - æˆ–ç›´æ¥æä¾› `latitude` å’Œ `longitude` å‚æ•°

2. **Difyå·¥ä½œæµæ›´æ–°**ï¼š
   - å¦‚æœå·¥ä½œæµä¸­ä½¿ç”¨äº† `location` å‚æ•°ï¼Œéœ€è¦æ”¹ä¸ºä½¿ç”¨ `project_id` æˆ– `latitude`/`longitude`
   - å…¶ä»–éƒ¨åˆ†æ— éœ€ä¿®æ”¹ï¼ˆAPIå“åº”æ ¼å¼ä¿æŒä¸€è‡´ï¼‰

---

## âœ… å®Œæˆ

æ‰€æœ‰å’Œé£å¤©æ°”ç›¸å…³ä»£ç å·²æˆåŠŸæ›¿æ¢ä¸ºOpen-Meteoï¼

ç°åœ¨APIå®Œå…¨å…è´¹ï¼Œæ— éœ€API Keyï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

